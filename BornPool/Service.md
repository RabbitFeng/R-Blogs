## 1. Service基础知识

### 服务概览

> `Service`是一种可以在后台长时间运行操作而不需要提供界面的应用组件。
>
> 即便用户切换到其他应用，服务仍将在后台继续运行；
>
> 组件也可以通过绑定到服务进行通信，甚至执行进程间通信(`IPC`)例如，服务可以在后台处理网络事务、播放音乐、执行文件`I/O`或者与内容提供程序交互等。

### 服务类型

`Service`有三种类型：

**前台服务**

> 执行用户能注意到的操作。例如，音乐软件使用前台服务播放音频。前台服务必须显示通知。即使用户停止与应用的交互，前台服务仍会继续运行。

**后台服务**

> 后台服务执行用户不会直接注意到的操作。
>
> **注意**：如果应用面向`API 26`或者啊更高版本。当应用本身未在前台时，系统会对运行后台服务施加限制。在诸如此类大多数情况下，应用应该为计划作业

**绑定服务**

> 应用组件通过调用`bindService()`绑定到服务时，服务即处于绑定状态。绑定服务提供客户端-服务器接口，便于组件和服务之间进行交互、发送请求、接受结果甚至利用`IPC`执行跨进程等操作。仅当与另一个应用组件绑定时，绑定服务才会运行。多个组件可同时绑定到服务，全部取消绑定后，服务会被销毁。

**启动方式**：启动服务、绑定服务

**服务性质**：本地服务（私有）、远程服务

> 服务在其托管进程的主线程中运行，既不创建自己的线程，也不在单独的进程中运行（可以指定）。如果服务将执行任何`CPU密集型`或`阻止性操作`（`MP3`播放或者联网）。则应该通过在服务内创建新线程来完成这项工作，用于降低发生`ANR`错误的风险。

### 服务`vs`线程

**服务**的侧重点在于是否需要在用户即使处在未和应用交互也可以在后台运行的组件。默认情况下，服务运行在应用的主线程中。如果服务执行的是密集型或者阻止型操作，应该在服务内创建线程。

**线程**的侧重点在于是否需要在主线程外做一些额外的操作，但只在与应用交互时执行操作。

> 比如，如果仅仅在用户同应用交互时播放一段音乐，则可以在`onCreate()`方法中创建线程，在`onStart()`中启动线程运行，然后在`onStop()`中停止线程。还可以考虑使用`AsyncTask`或者`HandlerThread`而非传统的Thread类

### `Service`回调方法

> 如果要创建服务，必须要创建`Service`的子类或者使用其直接子类`VpnService`等。那么在实现中，必须重写一些回调方法，从而处理服务声明周期的关键方面，并提供一种机制将组件绑定到服务。

#### 1. `onStartCommand()`

当另一个组件(如`Activity`)请求启动服务，系统通过调用`startService`来回调此方法。执行此方法，服务启动并可以在后台运行。

在服务工作完成后，需要通过调用`stopService(Intent)`或者`stopSelf(Int)`停止服务

