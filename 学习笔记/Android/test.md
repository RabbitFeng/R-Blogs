## ***\*异常时长治理\****

- ***\*线上数据摸底\****
  - 主要针对***\*超大时长(时长数小时或一天以上)以及时长不自洽(时长不准)\****两类问题做数据摸底；另外就是对日志格式完整性做新的一轮梳理。
  - ***\*核心动作\****
    - ***\*SQL优化：\****
      - 表字段没有拆除所有的业务字段，如起止时间等都记录在一个聚合的信息的JSON字段，采用***\*横向视图 Lateral View\****简化查询；***\*配合JSON_TUPLE\****提高查询速度；例行任务耗时耗时降低75%（2h->0.5h)；
- ***\*异常埋点链路分析\****
  - 回捞用户端上行为日志(业务埋点数据+日志业务处理流程)主要用于问题排查；业务调用埋点 -> 入线程池任务队列 -> 线程池任务执行 -> 持久化-> 上报等，
  - ***\*痛点问题：\****
    - ***\*数据特征：按行存储+文件切片\****，同一个埋点的处理链路数据是离散的（体现在行，文件）。人工排查需要大量全局检索；费时费力，出错的可能性很高。
    - ***\*数据体量：\****单个用户的一周数据达上百MB，文件数量数十个
  - ***\*核心动作\****
    - 少量用户去人工排查：适用于十几个用户的情况
    - ***\*脚本化处理：遍历文件行 + 日志提取 => excel中\****
      - ***\*方便量化统计\****
      - ***\*提高处理时效性、准确性\****
- ***\*异常归因修复\****
  - ***\*时长超大\****
    - 起止时间戳不准 ***\*System.\********\**currentTimeMillis\**\*******\*()\**** 时间跳变(用户手动调整 / 网络校准)
      - SystemClock.**elapsedRealtime**()计算时间
      - 除非服务端校准，否则没办法判断当前时间戳是否准确
- ***\*数据修复观察\****
  - 服务端修复，收敛快速，

## ***\*低端机性能优化\****

- ***\*背景\****  移动技术平台发起，负责日志SDK的耗时堆栈优化；分析插桩包的Systrace文件
  - ***\*Perfetto:\**** 支持SQL查询，埋点业务这种api频繁调用的情况，很适合用于做聚合分析；按package筛选，看到当前业务堆栈中的耗时方法。
  - ***\*配合火焰图，能够很好的定位耗时方法\****
- ***\*优化方向和手段\****
  - ***\*池化技术，避免线程池任务实例和相关Data实例大量频繁实例化；\****
    - 从pv统计来看，30秒内会有大量埋点日志，500~1000，日志埋点业务会频繁大量创建实例对象。带来内存抖动的风险；
  - ***\*时间戳格式化\****
    - 异常耗时，考虑在C++层格式化；因so库改动会引入不必要风险，最好是小版本处理，未进行
  - ***\*运行时日志采样记录\****
    - 运行时日志频繁记录会抢夺CPU资源

﻿

﻿

﻿

面试官你好，我叫董中锋，目前大概有四年多的Android从业经验，从业前两年主要在出海工具类产品，随着项目立项到产品上线，最后日活两百多万，核心工作会主要集中在UI相关的业务逻辑，后来也担任整个产品的功能迭代和产品体验优化；目前就是在百度这边的数据中台部门，做日志组件SDK，版本节奏会比较不固定，主要有些随季度的治理专项和技术调研，包括我这边提到的时长治理、性能优化相关的专项任务。然后我目前的求职意向的还是想要去更多的接触一线业务侧，更好的去培养产品思维。

﻿

﻿
